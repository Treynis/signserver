<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Tomcat Certificates</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body>
<table width="100%" border="0">
  <tr>
    <td><h1><font color="#006633">Obtaining a Certificate for Tomcat</font></h1></td>
  </tr>
  <tr>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Send an e-mail to the SensorNetCA (romeja@ornl.gov)
      requesting a Tomcat certificate. The e-mail should contain:
      <ul>
        <li>The ip name of your server</li>
        <li>Your name and e-mail address</li>
        <li>Your phone number</li>
        <li>Your Organization</li>
        <li>Your Organizational Unit</li>
        <li>Your City</li>
        <li>Your State</li>
        <li>Your Country</li>
      </ul>
      <p>When your request is approved, I will mail you an
        e-mail with a URL for you to pick up your certificate. Tomcat requires
        a jks certificate store format, so be sure to select jks when you get
        the certificate. You will have to save the jks keystore using your Web
        browser. Call the file <em>tomcat.jks</em>. The jks keystore is encrypted
        using the password in your e-mail. But there is more work to do before
        you
        can use the jks
        file
        in Tomcat.</p>
      <p>You should be able to use the keystore as given. However, the password
        for the store and the private key (which are set to the password in your
        e-mail) need to be changed to something stronger. Use keytool to do this:</p>
      <p>First, list the keystore to get the alias for your certificate (see
        below for sample output). My alias was ca.sensornet.gov. (Do not type
        the angle brackets in the commands below!)</p>
      <pre>$ keytool -list -keystore tomcat.jks 
      Enter keystore password: e-mail_password</pre>      
      <pre>$ keytool -keypasswd -alias &lt;alias for your server&gt; -keypass &lt;e-mail password&gt; -new &lt;new password&gt; \
 -keystore tomcat.jks<br>      Enter keystore password: e-mail_password
$ keytool -storepasswd -keystore tomcat.jks -new &lt;new password&gt;<br>      Enter keystore password: e-mail_password
</pre>
      <p>You should repeat the list command to be sure that your new password
        works. This should be all you need to do to get the jks file to work.
        But if not, you can try the following procedure:      </p>
      <p>The jks file generated by the SensorNet CA has two parts in it. One
        part is the SensorNetCA certificate to allow your server certificate
        to be verified. The other part is your server certificate. It also is
        encrypted using the password in your e-mail message. You can view the
        contents of your jks file using keytool (in your Java jdk/bin directory).</p>
      <pre>$ keytool -list -keystore tomcat.jks 
       Enter keystore password: your_password</pre>
      <pre>Keystore type: jks
         Keystore provider: SUN</pre>
      <pre>Your keystore contains 2 entries</pre>
      <pre>ca.sensornet.gov, Nov 13, 2006, keyEntry,
         Certificate fingerprint (MD5): FC:97:3F:B6:27:66:39:4E:CD:87:2E:7E:03:31:F1:B6
cacert, Nov 13, 2006, trustedCertEntry,
         Certificate fingerprint (MD5): 61:C4:07:4B:4A:BA:78:67:7D:60:F9:9B:E9:FE:3B:C5
</pre>
      <p>The first step is to extract your server certificate (for me, ca.sensornet.gov)
        from this file so we can remove the password, and then put it back into
        the jks keystore. The easiest way to do these steps is to use <a href="http://freshmeat.net/projects/pkeytool/">pkeytool</a>.
        The zip file contains an executable jar that will work on any platform.</p>
      <p>In the steps below, 'pkeytool' is something like</p>
      <pre>$ java -jar /usr/local/pkeytool/pkeytool.jar</pre>      <p>1) Extract your server certificate and your server key (use your
        alias from the step above):</p>
      <pre>$ 'pkeytool' -exportkey -alias ca.sensornet.gov -file server.key -keystore tomcat.jks<br>  (enter keystore password from the e-mail)<br>  (enter key password from the e-mail)</pre>
      <pre>$ keytool -export -alias ca.sensornet.gov -file server.cert -keystore tomcat.jks
   (enter keystore password from the e-mail)</pre>
      <p>2) Import the certificate and key back into the jks file with no password:</p>      <pre>$ 'pkeytool' -importkey -keyfile server.key -certfile server.cert -alias ca.sensornet.<br>gov -keystore tomcat.jks<br>  (enter keystore password from the e-mail)</pre>
      <p>3) Protect your keystore with a better password:</p>
      <pre>$ keytool -storepasswd -new &lt;new_storepass&gt; -keystore tomcat.jks
  (enter keystore password from the e-mail)</pre>
      <p>Install the resulting tomcat.jks file at the location pointed to in
    your tomcat ssl configuration file.</p></td>
  </tr>
</table>
</body>
</html>
